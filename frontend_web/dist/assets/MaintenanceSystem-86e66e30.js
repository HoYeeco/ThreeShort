import{E as R,I as A,p as U,D as k,v as z}from"./element-a02f8ecb.js";import{r as p}from"./index-3d03330f.js";import{x as B,r as y,k as F,z as G,A as a,Q as e,I as o,ag as l,y as L,u as m,M as C,C as E,O as i}from"./vendor-0e940c15.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"maintenance-system"},W={class:"page-header"},H={class:"header-actions"},K={class:"status-content"},X={class:"status-info"},q={class:"status-text"},Q={class:"status-content"},Y={class:"status-info"},j={class:"status-text"},J={class:"status-content"},Z={class:"status-info"},$={class:"status-text"},tt={class:"card-header"},et={class:"event-count"},at=B({__name:"MaintenanceSystem",setup(st){const n=y({overall:"normal",database:"normal",application:"normal"}),S=y({userCount:0,creditReportCount:0,exchangeCount:0,feedbackCount:0,logCount:0,lastUpdate:""}),v=y([]),f=()=>{b(),w(),I()},b=async()=>{try{const s=await p.get("/system/database/health"),t=await p.get("/system/statistics");n.value={overall:"normal",database:s.data?"normal":"error",application:t.data?"normal":"error"}}catch{n.value={overall:"error",database:"error",application:"error"}}},w=async()=>{try{const t=(await p.get("/system/statistics")).data;S.value={userCount:t.userCount||0,creditReportCount:t.creditReportCount||0,exchangeCount:t.exchangeCount||0,feedbackCount:t.feedbackCount||0,logCount:t.logCount||0,lastUpdate:new Date().toISOString()}}catch{R.error("加载数据统计失败")}},I=async()=>{var s;try{const c=((s=(await p.get("/system/logs/list",{params:{page:1,size:20}})).data)==null?void 0:s.records)||[];v.value=c.map(r=>({time:r.createdTime,level:r.status==="SUCCESS"?"INFO":r.status==="FAILED"?"ERROR":"WARN",module:x(r.operationType),message:r.operationDesc}))}catch{R.error("加载系统事件失败")}},x=s=>({USER_LOGIN:"用户认证",USER_REGISTER:"用户管理",CREDIT_REPORT:"信用管理",CREDIT_REVIEW:"信用审核",POINT_EXCHANGE:"积分商城",FEEDBACK_SUBMIT:"反馈系统",TASK_EXECUTION:"定时任务",SYSTEM_OPERATION:"系统维护"})[s]||"系统",g=s=>({normal:"正常",warning:"警告",error:"异常"})[s]||s,T=s=>({INFO:"primary",WARN:"warning",ERROR:"danger",DEBUG:"info"})[s]||"default",M=s=>s?new Date(s).toLocaleString("zh-CN"):"-";return F(()=>{f(),setInterval(()=>{f()},3e4)}),(s,t)=>{const c=l("el-icon"),r=l("el-button"),d=l("el-card"),h=l("el-col"),N=l("el-row"),u=l("el-table-column"),O=l("el-tag"),D=l("el-table");return L(),G("div",P,[a("div",W,[t[1]||(t[1]=a("h2",null,"系统监控",-1)),a("div",H,[e(r,{type:"primary",onClick:f},{default:o(()=>[e(c,null,{default:o(()=>[e(m(A))]),_:1}),t[0]||(t[0]=C(" 刷新数据 "))]),_:1,__:[0]})])]),e(N,{gutter:20,style:{"margin-bottom":"20px"}},{default:o(()=>[e(h,{span:8},{default:o(()=>[e(d,{class:"status-card"},{default:o(()=>[a("div",K,[a("div",{class:E(["status-indicator",n.value.overall])},[e(c,{size:"40"},{default:o(()=>[e(m(U))]),_:1})],2),a("div",X,[t[2]||(t[2]=a("div",{class:"status-title"},"系统状态",-1)),a("div",q,i(g(n.value.overall)),1)])])]),_:1})]),_:1}),e(h,{span:8},{default:o(()=>[e(d,{class:"status-card"},{default:o(()=>[a("div",Q,[a("div",{class:E(["status-indicator",n.value.database])},[e(c,{size:"40"},{default:o(()=>[e(m(k))]),_:1})],2),a("div",Y,[t[3]||(t[3]=a("div",{class:"status-title"},"数据库",-1)),a("div",j,i(g(n.value.database)),1)])])]),_:1})]),_:1}),e(h,{span:8},{default:o(()=>[e(d,{class:"status-card"},{default:o(()=>[a("div",J,[a("div",{class:E(["status-indicator",n.value.application])},[e(c,{size:"40"},{default:o(()=>[e(m(z))]),_:1})],2),a("div",Z,[t[4]||(t[4]=a("div",{class:"status-title"},"应用服务",-1)),a("div",$,i(g(n.value.application)),1)])])]),_:1})]),_:1})]),_:1}),e(d,null,{header:o(()=>[a("div",tt,[t[5]||(t[5]=a("span",null,"最近系统事件",-1)),a("span",et,"共 "+i(v.value.length)+" 条记录",1)])]),default:o(()=>[e(D,{data:v.value,style:{width:"100%"},"max-height":"400"},{default:o(()=>[e(u,{prop:"time",label:"时间",width:"180"},{default:o(_=>[C(i(M(_.row.time)),1)]),_:1}),e(u,{prop:"level",label:"级别",width:"80"},{default:o(_=>[e(O,{type:T(_.row.level)},{default:o(()=>[C(i(_.row.level),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"module",label:"模块",width:"120"}),e(u,{prop:"message",label:"事件描述","min-width":"300","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1})])}}});const ct=V(at,[["__scopeId","data-v-47fe3964"]]);export{ct as default};
