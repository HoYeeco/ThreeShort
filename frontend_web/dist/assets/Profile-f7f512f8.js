import{u as $}from"./index-3d03330f.js";import{E as c}from"./element-a02f8ecb.js";import{x as B,r as w,X as x,k as M,z as S,Q as r,I as a,ag as i,y as j,A as b,M as g}from"./vendor-0e940c15.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";const O={class:"profile-container"},X={class:"dialog-footer"},z=B({__name:"Profile",setup(A){const t=$(),m=w(),_=w(),V=w(!1),P=w(!1),p=w(!1),s=x({username:"",realName:"",phone:"",idCard:"",address:""}),d=x({oldPassword:"",newPassword:"",confirmPassword:""}),N={realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{max:50,message:"真实姓名长度不能超过50个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],idCard:[{required:!0,message:"请输入身份证号",trigger:"blur"},{pattern:/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,message:"身份证号格式不正确",trigger:"blur"}],address:[{max:200,message:"住址长度不能超过200个字符",trigger:"blur"}]},k={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(o,e,n)=>{e!==d.newPassword?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}]},y=async()=>{if(t.userInfo)try{const o=await t.fetchUserInfo(t.userInfo.id);Object.assign(s,{username:o.username,realName:o.realName,phone:o.phone||"",idCard:o.idCard||"",address:o.address||""})}catch(o){console.error("获取用户信息失败:",o),Object.assign(s,{username:t.userInfo.username,realName:t.userInfo.realName,phone:t.userInfo.phone||"",idCard:t.userInfo.idCard||"",address:t.userInfo.address||""})}},F=async()=>{if(m.value)try{await m.value.validate(),V.value=!0;const o={realName:s.realName,phone:s.phone,idCard:s.idCard,address:s.address};await t.updateUserInfo(o),c.success("信息更新成功")}catch(o){if(o.fields)return;c.error(o.message||"更新失败")}finally{V.value=!1}},q=()=>{m.value&&m.value.resetFields(),y()},h=async()=>{if(!(!_.value||!t.userInfo))try{await _.value.validate(),P.value=!0,await t.changePassword(t.userInfo.id,d.oldPassword,d.newPassword),c.success("密码修改成功"),p.value=!1,C()}catch(o){if(o.fields)return;c.error(o.message||"密码修改失败")}finally{P.value=!1}},C=()=>{var o;d.oldPassword="",d.newPassword="",d.confirmPassword="",(o=_.value)==null||o.clearValidate()};return M(async()=>{await y()}),(o,e)=>{const n=i("el-input"),u=i("el-form-item"),v=i("el-col"),I=i("el-row"),f=i("el-button"),U=i("el-form"),R=i("el-card"),E=i("el-dialog");return j(),S("div",O,[r(R,null,{header:a(()=>e[11]||(e[11]=[b("div",{class:"card-header"},[b("span",null,"个人信息")],-1)])),default:a(()=>[r(U,{ref_key:"profileFormRef",ref:m,model:s,rules:N,"label-width":"100px",class:"profile-form"},{default:a(()=>[r(I,{gutter:20},{default:a(()=>[r(v,{span:12},{default:a(()=>[r(u,{label:"用户名",prop:"username"},{default:a(()=>[r(n,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=l=>s.username=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),r(v,{span:12},{default:a(()=>[r(u,{label:"真实姓名",prop:"realName"},{default:a(()=>[r(n,{modelValue:s.realName,"onUpdate:modelValue":e[1]||(e[1]=l=>s.realName=l),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(I,{gutter:20},{default:a(()=>[r(v,{span:12},{default:a(()=>[r(u,{label:"手机号",prop:"phone"},{default:a(()=>[r(n,{modelValue:s.phone,"onUpdate:modelValue":e[2]||(e[2]=l=>s.phone=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),r(v,{span:12},{default:a(()=>[r(u,{label:"身份证号",prop:"idCard"},{default:a(()=>[r(n,{modelValue:s.idCard,"onUpdate:modelValue":e[3]||(e[3]=l=>s.idCard=l),placeholder:"请输入身份证号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(u,{label:"住址",prop:"address"},{default:a(()=>[r(n,{modelValue:s.address,"onUpdate:modelValue":e[4]||(e[4]=l=>s.address=l),placeholder:"请输入住址",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),r(u,null,{default:a(()=>[r(f,{type:"primary",loading:V.value,onClick:F},{default:a(()=>e[12]||(e[12]=[g(" 保存修改 ")])),_:1,__:[12]},8,["loading"]),r(f,{onClick:q},{default:a(()=>e[13]||(e[13]=[g("重置")])),_:1,__:[13]}),r(f,{type:"warning",onClick:e[5]||(e[5]=l=>p.value=!0)},{default:a(()=>e[14]||(e[14]=[g(" 修改密码 ")])),_:1,__:[14]})]),_:1})]),_:1},8,["model"])]),_:1}),r(E,{modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=l=>p.value=l),title:"修改密码",width:"400px",onClose:C},{footer:a(()=>[b("span",X,[r(f,{onClick:e[9]||(e[9]=l=>p.value=!1)},{default:a(()=>e[15]||(e[15]=[g("取消")])),_:1,__:[15]}),r(f,{type:"primary",loading:P.value,onClick:h},{default:a(()=>e[16]||(e[16]=[g(" 确定修改 ")])),_:1,__:[16]},8,["loading"])])]),default:a(()=>[r(U,{ref_key:"passwordFormRef",ref:_,model:d,rules:k,"label-width":"100px"},{default:a(()=>[r(u,{label:"原密码",prop:"oldPassword"},{default:a(()=>[r(n,{modelValue:d.oldPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>d.oldPassword=l),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1}),r(u,{label:"新密码",prop:"newPassword"},{default:a(()=>[r(n,{modelValue:d.newPassword,"onUpdate:modelValue":e[7]||(e[7]=l=>d.newPassword=l),type:"password",placeholder:"请输入新密码（6位以上）","show-password":""},null,8,["modelValue"])]),_:1}),r(u,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[r(n,{modelValue:d.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=l=>d.confirmPassword=l),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const J=D(z,[["__scopeId","data-v-18021f05"]]);export{J as default};
