import{q as B,I as L,T as D,C as M,U,z as k,E as m}from"./element-a02f8ecb.js";import{r as y}from"./index-3d03330f.js";import{x as G,r as p,k as I,z as q,Q as e,I as s,ag as o,y as A,A as t,u as d,M as g,O as _}from"./vendor-0e940c15.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";const V={class:"maintenance-tasks"},z={class:"quick-actions"},F={class:"action-header"},O={class:"action-content"},Q={class:"action-header"},R={class:"action-content"},j={class:"status-item"},H={class:"status-icon success"},J={class:"status-item"},K={class:"status-icon info"},P={class:"status-info"},W={class:"status-item"},X={class:"status-icon warning"},Y={class:"status-info"},Z=G({__name:"MaintenanceTasks",setup($){const l=p({scoreGeneration:!1,recalculateCredit:!1}),x=p("周一 02:00"),v=p("暂无记录"),c=p([{time:"2024-01-15 02:00:00",task:"信用分数计算",status:"SUCCESS",message:"成功处理10个用户的评分记录"},{time:"2024-01-14 03:00:00",task:"信用等级重算",status:"SUCCESS",message:"重新计算完成，更新5个用户等级"}]),w=async()=>{try{await k.confirm("确定要手动执行信用分数计算吗？这将为所有用户生成当前周期的评分记录。","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),l.value.scoreGeneration=!0,await y.post("/system/tasks/execute/score-generation"),m.success("信用分数计算执行成功！"),c.value.unshift({time:new Date().toLocaleString(),task:"信用分数计算",status:"SUCCESS",message:"手动执行成功"}),v.value="刚刚"}catch(n){n!=="cancel"&&(m.error(n.message||"执行失败"),c.value.unshift({time:new Date().toLocaleString(),task:"信用分数计算",status:"FAILED",message:n.message||"执行失败"}))}finally{l.value.scoreGeneration=!1}},b=async()=>{try{await k.confirm("确定要重新计算所有用户的信用等级吗？这可能需要一些时间。","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),l.value.recalculateCredit=!0,await y.post("/system/tasks/execute/recalculate-credit"),m.success("信用等级重算执行成功！"),c.value.unshift({time:new Date().toLocaleString(),task:"信用等级重算",status:"SUCCESS",message:"手动执行成功"}),v.value="刚刚"}catch(n){n!=="cancel"&&(m.error(n.message||"执行失败"),c.value.unshift({time:new Date().toLocaleString(),task:"信用等级重算",status:"FAILED",message:n.message||"执行失败"}))}finally{l.value.recalculateCredit=!1}};return I(()=>{console.log("定时任务管理页面已加载")}),(n,a)=>{const u=o("el-icon"),C=o("el-button"),i=o("el-card"),r=o("el-col"),S=o("el-row"),f=o("el-table-column"),E=o("el-tag"),T=o("el-table");return A(),q("div",V,[e(i,{class:"header-card"},{header:s(()=>a[0]||(a[0]=[t("div",{class:"card-header"},[t("h2",null,"定时任务管理"),t("p",null,"管理系统定时任务和手动同步操作")],-1)])),default:s(()=>[t("div",z,[e(S,{gutter:20},{default:s(()=>[e(r,{span:12},{default:s(()=>[e(i,{class:"action-card"},{header:s(()=>[t("div",F,[e(u,null,{default:s(()=>[e(d(B))]),_:1}),a[1]||(a[1]=t("span",null,"信用分数计算",-1))])]),default:s(()=>[t("div",O,[a[2]||(a[2]=t("p",null,"手动触发信用分数计算和评分记录生成",-1)),e(C,{type:"primary",loading:l.value.scoreGeneration,onClick:w},{default:s(()=>[g(_(l.value.scoreGeneration?"执行中...":"立即同步"),1)]),_:1},8,["loading"])])]),_:1})]),_:1}),e(r,{span:12},{default:s(()=>[e(i,{class:"action-card"},{header:s(()=>[t("div",Q,[e(u,null,{default:s(()=>[e(d(L))]),_:1}),a[3]||(a[3]=t("span",null,"信用等级重算",-1))])]),default:s(()=>[t("div",R,[a[4]||(a[4]=t("p",null,"重新计算所有用户的信用等级",-1)),e(C,{type:"success",loading:l.value.recalculateCredit,onClick:b},{default:s(()=>[g(_(l.value.recalculateCredit?"执行中...":"立即重算"),1)]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1})])]),_:1}),e(i,{class:"status-card"},{header:s(()=>a[5]||(a[5]=[t("h3",null,"任务状态概览",-1)])),default:s(()=>[e(S,{gutter:20},{default:s(()=>[e(r,{span:8},{default:s(()=>[t("div",j,[t("div",H,[e(u,null,{default:s(()=>[e(d(D))]),_:1})]),a[6]||(a[6]=t("div",{class:"status-info"},[t("h4",null,"系统任务"),t("p",null,"2个定时任务正在运行")],-1))])]),_:1}),e(r,{span:8},{default:s(()=>[t("div",J,[t("div",K,[e(u,null,{default:s(()=>[e(d(M))]),_:1})]),t("div",P,[a[7]||(a[7]=t("h4",null,"下次执行",-1)),t("p",null,_(x.value),1)])])]),_:1}),e(r,{span:8},{default:s(()=>[t("div",W,[t("div",X,[e(u,null,{default:s(()=>[e(d(U))]),_:1})]),t("div",Y,[a[8]||(a[8]=t("h4",null,"最近执行",-1)),t("p",null,_(v.value),1)])])]),_:1})]),_:1})]),_:1}),e(i,{class:"log-card"},{header:s(()=>a[9]||(a[9]=[t("h3",null,"最近执行记录",-1)])),default:s(()=>[e(T,{data:c.value,style:{width:"100%"}},{default:s(()=>[e(f,{prop:"time",label:"执行时间",width:"180"}),e(f,{prop:"task",label:"任务名称"}),e(f,{prop:"status",label:"状态",width:"100"},{default:s(h=>[e(E,{type:h.row.status==="SUCCESS"?"success":"danger"},{default:s(()=>[g(_(h.row.status==="SUCCESS"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"message",label:"执行结果"})]),_:1},8,["data"])]),_:1})])}}});const le=N(Z,[["__scopeId","data-v-bee83e2b"]]);export{le as default};
