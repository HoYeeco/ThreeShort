import{E as L,I as $,P as re,d as ie,Q as _e,R as pe,C as ce,H as me,S as ve,z as fe}from"./element-a02f8ecb.js";import{r as V}from"./index-9f97b358.js";import{x as ge,r as p,h as ye,k as Te,z as U,A as s,Q as e,I as t,ag as n,aq as be,y as C,u as g,M as u,O as d,J as Ee,H as N,L as q}from"./vendor-0e940c15.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";const Ie={class:"maintenance-logs"},we={class:"page-header"},Se={class:"header-actions"},Re={class:"stat-content"},De={class:"stat-number"},xe={class:"stat-icon"},Le={class:"stat-content"},ke={class:"stat-number"},Me={class:"stat-icon"},Oe={class:"stat-content"},Ve={class:"stat-number"},Ue={class:"stat-icon"},Ne={class:"stat-content"},he={class:"stat-number"},ze={class:"stat-icon"},Ae={class:"card-header"},Pe={class:"total-count"},Ye={key:0},He={key:1},Ge={class:"pagination"},Fe=ge({__name:"MaintenanceLogs",setup(Be){const h=p([]),I=p({totalLogs:0,successLogs:0,failedLogs:0,errorLogs:0,recentLogs:0}),i=p(null),r=p({operationType:"",status:"",userId:"",startTime:"",endTime:""}),R=p(null),_=p({current:1,size:20,total:0}),w=p({keepDays:30}),k=p(!1),S=p(!1),M=p(!1),O=p(!1);ye(R,o=>{o&&o.length===2?(r.value.startTime=o[0],r.value.endTime=o[1]):(r.value.startTime="",r.value.endTime="")});const y=async()=>{M.value=!0;try{const o={page:_.value.current,size:_.value.size,operationType:r.value.operationType||void 0,status:r.value.status||void 0,userId:r.value.userId||void 0,startTime:r.value.startTime||void 0,endTime:r.value.endTime||void 0},a=await V.get("/system/logs/list",{params:o});h.value=a.data.records||[],_.value.total=a.data.total||0}catch{L.error("加载日志失败")}finally{M.value=!1}},z=async()=>{try{const o=await V.get("/system/logs/statistics?days=7");I.value=o.data}catch{L.error("加载统计数据失败")}},K=()=>{_.value.current=1,y()},Q=()=>{r.value={operationType:"",status:"",userId:"",startTime:"",endTime:""},R.value=null,_.value.current=1,y()},j=({prop:o,order:a})=>{y()},J=o=>{i.value=o,k.value=!0},W=async()=>{try{await fe.confirm(`确定要清理 ${w.value.keepDays} 天前的历史日志吗？此操作不可恢复！`,"确认清理",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),O.value=!0,await V.delete(`/system/logs/clean?keepDays=${w.value.keepDays}`),L.success("历史日志清理成功"),S.value=!1,y(),z()}catch(o){o!=="cancel"&&L.error("清理失败")}finally{O.value=!1}},A=o=>({USER_LOGIN:"用户登录",USER_REGISTER:"用户注册",CREDIT_REPORT:"信用上报",POINT_EXCHANGE:"积分兑换",TASK_EXECUTION:"任务执行",SYSTEM_OPERATION:"系统操作"})[o]||o,P=o=>({USER_LOGIN:"primary",USER_REGISTER:"success",CREDIT_REPORT:"warning",POINT_EXCHANGE:"info",TASK_EXECUTION:"danger",SYSTEM_OPERATION:"default"})[o]||"default",Y=o=>({SUCCESS:"成功",FAILED:"失败",ERROR:"错误"})[o]||o,H=o=>({SUCCESS:"success",FAILED:"warning",ERROR:"danger"})[o]||"default",G=o=>o?new Date(o).toLocaleString("zh-CN"):"-";return Te(()=>{y(),z()}),(o,a)=>{const c=n("el-icon"),T=n("el-button"),E=n("el-card"),D=n("el-col"),Z=n("el-row"),m=n("el-option"),F=n("el-select"),b=n("el-form-item"),ee=n("el-input"),te=n("el-date-picker"),B=n("el-form"),v=n("el-table-column"),x=n("el-tag"),ae=n("el-table"),le=n("el-pagination"),f=n("el-descriptions-item"),oe=n("el-text"),se=n("el-descriptions"),X=n("el-dialog"),ne=n("el-input-number"),ue=n("el-alert"),de=be("loading");return C(),U("div",Ie,[s("div",we,[a[12]||(a[12]=s("h2",null,"操作日志管理",-1)),s("div",Se,[e(T,{type:"primary",onClick:y},{default:t(()=>[e(c,null,{default:t(()=>[e(g($))]),_:1}),a[10]||(a[10]=u(" 刷新 "))]),_:1,__:[10]}),e(T,{type:"danger",onClick:S.value},{default:t(()=>[e(c,null,{default:t(()=>[e(g(re))]),_:1}),a[11]||(a[11]=u(" 清理日志 "))]),_:1,__:[11]},8,["onClick"])])]),e(Z,{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[e(D,{span:6},{default:t(()=>[e(E,{class:"stat-card"},{default:t(()=>[s("div",Re,[s("div",De,d(I.value.totalLogs||0),1),a[13]||(a[13]=s("div",{class:"stat-label"},"总日志数",-1))]),s("div",xe,[e(c,{size:"40",color:"#409EFF"},{default:t(()=>[e(g(ie))]),_:1})])]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(E,{class:"stat-card"},{default:t(()=>[s("div",Le,[s("div",ke,d(I.value.successLogs||0),1),a[14]||(a[14]=s("div",{class:"stat-label"},"成功操作",-1))]),s("div",Me,[e(c,{size:"40",color:"#67C23A"},{default:t(()=>[e(g(_e))]),_:1})])]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(E,{class:"stat-card"},{default:t(()=>[s("div",Oe,[s("div",Ve,d(I.value.failedLogs||0),1),a[15]||(a[15]=s("div",{class:"stat-label"},"失败操作",-1))]),s("div",Ue,[e(c,{size:"40",color:"#F56C6C"},{default:t(()=>[e(g(pe))]),_:1})])]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(E,{class:"stat-card"},{default:t(()=>[s("div",Ne,[s("div",he,d(I.value.recentLogs||0),1),a[16]||(a[16]=s("div",{class:"stat-label"},"近7天日志",-1))]),s("div",ze,[e(c,{size:"40",color:"#E6A23C"},{default:t(()=>[e(g(ce))]),_:1})])]),_:1})]),_:1})]),_:1}),e(E,{style:{"margin-bottom":"20px"}},{default:t(()=>[e(B,{model:r.value,inline:""},{default:t(()=>[e(b,{label:"操作类型"},{default:t(()=>[e(F,{modelValue:r.value.operationType,"onUpdate:modelValue":a[0]||(a[0]=l=>r.value.operationType=l),placeholder:"请选择操作类型",clearable:""},{default:t(()=>[e(m,{label:"用户登录",value:"USER_LOGIN"}),e(m,{label:"用户注册",value:"USER_REGISTER"}),e(m,{label:"信用上报",value:"CREDIT_REPORT"}),e(m,{label:"积分兑换",value:"POINT_EXCHANGE"}),e(m,{label:"任务执行",value:"TASK_EXECUTION"}),e(m,{label:"系统操作",value:"SYSTEM_OPERATION"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"操作状态"},{default:t(()=>[e(F,{modelValue:r.value.status,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value.status=l),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(m,{label:"成功",value:"SUCCESS"}),e(m,{label:"失败",value:"FAILED"}),e(m,{label:"错误",value:"ERROR"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"用户ID"},{default:t(()=>[e(ee,{modelValue:r.value.userId,"onUpdate:modelValue":a[2]||(a[2]=l=>r.value.userId=l),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),e(b,{label:"时间范围"},{default:t(()=>[e(te,{modelValue:R.value,"onUpdate:modelValue":a[3]||(a[3]=l=>R.value=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(b,null,{default:t(()=>[e(T,{type:"primary",onClick:K},{default:t(()=>[e(c,null,{default:t(()=>[e(g(me))]),_:1}),a[17]||(a[17]=u(" 查询 "))]),_:1,__:[17]}),e(T,{onClick:Q},{default:t(()=>[e(c,null,{default:t(()=>[e(g($))]),_:1}),a[18]||(a[18]=u(" 重置 "))]),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),_:1}),e(E,null,{header:t(()=>[s("div",Ae,[a[19]||(a[19]=s("span",null,"操作日志列表",-1)),s("span",Pe,"共 "+d(_.value.total)+" 条记录",1)])]),default:t(()=>[Ee((C(),N(ae,{data:h.value,style:{width:"100%"},onSortChange:j},{default:t(()=>[e(v,{prop:"id",label:"日志ID",width:"80"}),e(v,{prop:"operationType",label:"操作类型",width:"120"},{default:t(l=>[e(x,{type:P(l.row.operationType)},{default:t(()=>[u(d(A(l.row.operationType)),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"operationDesc",label:"操作描述","min-width":"200","show-overflow-tooltip":""}),e(v,{prop:"userId",label:"用户ID",width:"80"}),e(v,{prop:"status",label:"状态",width:"80"},{default:t(l=>[e(x,{type:H(l.row.status)},{default:t(()=>[u(d(Y(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"ipAddress",label:"IP地址",width:"140"}),e(v,{prop:"executionTime",label:"执行时长",width:"100"},{default:t(l=>[l.row.executionTime?(C(),U("span",Ye,d(l.row.executionTime)+"ms",1)):(C(),U("span",He,"-"))]),_:1}),e(v,{prop:"createdTime",label:"操作时间",width:"180",sortable:"custom"},{default:t(l=>[u(d(G(l.row.createdTime)),1)]),_:1}),e(v,{label:"操作",width:"100",fixed:"right"},{default:t(l=>[e(T,{type:"text",onClick:Xe=>J(l.row)},{default:t(()=>[e(c,null,{default:t(()=>[e(g(ve))]),_:1}),a[20]||(a[20]=u(" 详情 "))]),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,M.value]]),s("div",Ge,[e(le,{"current-page":_.value.current,"onUpdate:currentPage":a[4]||(a[4]=l=>_.value.current=l),"page-size":_.value.size,"onUpdate:pageSize":a[5]||(a[5]=l=>_.value.size=l),"page-sizes":[10,20,50,100],total:_.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1}),e(X,{modelValue:k.value,"onUpdate:modelValue":a[6]||(a[6]=l=>k.value=l),title:"日志详情",width:"800px"},{default:t(()=>[i.value?(C(),N(se,{key:0,column:2,border:""},{default:t(()=>[e(f,{label:"日志ID"},{default:t(()=>[u(d(i.value.id),1)]),_:1}),e(f,{label:"操作类型"},{default:t(()=>[e(x,{type:P(i.value.operationType)},{default:t(()=>[u(d(A(i.value.operationType)),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"操作描述",span:2},{default:t(()=>[u(d(i.value.operationDesc),1)]),_:1}),e(f,{label:"用户ID"},{default:t(()=>[u(d(i.value.userId||"-"),1)]),_:1}),e(f,{label:"状态"},{default:t(()=>[e(x,{type:H(i.value.status)},{default:t(()=>[u(d(Y(i.value.status)),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"IP地址"},{default:t(()=>[u(d(i.value.ipAddress||"-"),1)]),_:1}),e(f,{label:"执行时长"},{default:t(()=>[u(d(i.value.executionTime?i.value.executionTime+"ms":"-"),1)]),_:1}),e(f,{label:"操作时间",span:2},{default:t(()=>[u(d(G(i.value.createdTime)),1)]),_:1}),i.value.errorMessage?(C(),N(f,{key:0,label:"错误信息",span:2},{default:t(()=>[e(oe,{type:"danger"},{default:t(()=>[u(d(i.value.errorMessage),1)]),_:1})]),_:1})):q("",!0)]),_:1})):q("",!0)]),_:1},8,["modelValue"]),e(X,{modelValue:S.value,"onUpdate:modelValue":a[9]||(a[9]=l=>S.value=l),title:"清理历史日志",width:"500px"},{footer:t(()=>[e(T,{onClick:a[8]||(a[8]=l=>S.value=!1)},{default:t(()=>a[22]||(a[22]=[u("取消")])),_:1,__:[22]}),e(T,{type:"danger",onClick:W,loading:O.value},{default:t(()=>a[23]||(a[23]=[u(" 确认清理 ")])),_:1,__:[23]},8,["loading"])]),default:t(()=>[e(B,{model:w.value,"label-width":"120px"},{default:t(()=>[e(b,{label:"保留天数"},{default:t(()=>[e(ne,{modelValue:w.value.keepDays,"onUpdate:modelValue":a[7]||(a[7]=l=>w.value.keepDays=l),min:7,max:365,placeholder:"请输入保留天数"},null,8,["modelValue"]),a[21]||(a[21]=s("div",{class:"form-tip"},"最少保留7天，最多保留365天",-1))]),_:1,__:[21]}),e(b,null,{default:t(()=>[e(ue,{title:"注意",type:"warning",description:"此操作将永久删除指定天数之前的历史日志，请谨慎操作！","show-icon":"",closable:!1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const je=Ce(Fe,[["__scopeId","data-v-8dedb09b"]]);export{je as default};
