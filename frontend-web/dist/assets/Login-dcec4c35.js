import{x as N,r as c,X as U,z as S,A as l,Q as s,I as o,M as p,a5 as h,aA as A,ag as n,y as D,u as i,O as I}from"./vendor-0e940c15.js";import{u as K,r as M}from"./index-3d03330f.js";import{h as T,b as w,u as $,l as O,E as v}from"./element-a02f8ecb.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";const W={class:"login-container"},X={class:"login-content"},j={class:"login-info"},G={class:"info-content"},H={class:"system-title"},J={class:"feature-list"},Y={class:"feature-item"},Z={class:"feature-item"},ee={class:"feature-item"},se={class:"feature-item"},le={class:"login-box"},oe={class:"login-footer"},re={class:"dialog-footer"},ae=N({__name:"Login",setup(te){const x=A(),q=K(),y=c(),d=U({username:"",password:""}),F={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},f=c(!1),g=c(!1),b=c(),V=c(!1),r=U({username:"",newPassword:"",confirmPassword:""}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(u,e,t)=>{e!==r.newPassword?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]},k=async()=>{if(!(!y.value||f.value))try{f.value=!0,await y.value.validate(),await q.login(d),v.success("登录成功"),x.push("/dashboard")}catch(u){if(u.fields)return;v.error(u.message||"登录失败")}finally{f.value=!1}},E=async()=>{if(b.value)try{await b.value.validate(),V.value=!0,await M.post("/auth/reset-password",null,{params:{username:r.username,newPassword:r.newPassword}}),v.success("密码重置成功，请使用新密码登录"),g.value=!1,r.username="",r.newPassword="",r.confirmPassword=""}catch(u){v.error(u.message||"密码重置失败")}finally{V.value=!1}},z=()=>{x.push("/register")};return(u,e)=>{const t=n("el-icon"),_=n("el-input"),m=n("el-form-item"),P=n("el-button"),C=n("el-form"),R=n("el-link"),B=n("el-dialog");return D(),S("div",W,[e[19]||(e[19]=l("div",{class:"bg-decoration"},[l("div",{class:"circle circle-1"}),l("div",{class:"circle circle-2"}),l("div",{class:"circle circle-3"})],-1)),l("div",X,[l("div",j,[l("div",G,[l("h1",H,[s(t,{class:"title-icon"},{default:o(()=>[s(i(T))]),_:1}),e[8]||(e[8]=p(" 社区诚信管理系统 "))]),e[13]||(e[13]=l("p",{class:"system-desc"},"构建诚信社区，共享美好生活",-1)),l("div",J,[l("div",Y,[s(t,null,{default:o(()=>[s(i(w))]),_:1}),e[9]||(e[9]=l("span",null,"信用行为管理",-1))]),l("div",Z,[s(t,null,{default:o(()=>[s(i(w))]),_:1}),e[10]||(e[10]=l("span",null,"积分兑换服务",-1))]),l("div",ee,[s(t,null,{default:o(()=>[s(i(w))]),_:1}),e[11]||(e[11]=l("span",null,"社区公约学习",-1))]),l("div",se,[s(t,null,{default:o(()=>[s(i(w))]),_:1}),e[12]||(e[12]=l("span",null,"居民反馈建议",-1))])])])]),l("div",le,[e[16]||(e[16]=l("div",{class:"login-header"},[l("h2",null,"欢迎登录"),l("p",{class:"subtitle"},"Web管理端")],-1)),s(C,{ref_key:"loginFormRef",ref:y,model:d,rules:F,class:"login-form","label-width":"0",onKeyup:h(k,["enter"])},{default:o(()=>[s(m,{prop:"username"},{default:o(()=>[s(_,{modelValue:d.username,"onUpdate:modelValue":e[0]||(e[0]=a=>d.username=a),placeholder:"请输入用户名",size:"large","prefix-icon":i($),class:"login-input"},null,8,["modelValue","prefix-icon"])]),_:1}),s(m,{prop:"password"},{default:o(()=>[s(_,{modelValue:d.password,"onUpdate:modelValue":e[1]||(e[1]=a=>d.password=a),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":i(O),"show-password":"",class:"login-input"},null,8,["modelValue","prefix-icon"])]),_:1}),s(m,null,{default:o(()=>[s(P,{type:"primary",class:"login-btn",loading:f.value,onClick:k},{default:o(()=>[p(I(f.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),l("div",oe,[s(R,{type:"primary",onClick:e[2]||(e[2]=a=>g.value=!0)},{default:o(()=>e[14]||(e[14]=[p("忘记密码？")])),_:1,__:[14]}),s(R,{type:"primary",onClick:z},{default:o(()=>e[15]||(e[15]=[p("注册账号")])),_:1,__:[15]})])])]),s(B,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=a=>g.value=a),title:"找回密码",width:"400px"},{footer:o(()=>[l("div",re,[s(P,{onClick:e[6]||(e[6]=a=>g.value=!1)},{default:o(()=>e[17]||(e[17]=[p("取消")])),_:1,__:[17]}),s(P,{type:"primary",loading:V.value,onClick:E},{default:o(()=>e[18]||(e[18]=[p(" 确定重置 ")])),_:1,__:[18]},8,["loading"])])]),default:o(()=>[s(C,{model:r,rules:L,ref_key:"resetFormRef",ref:b,"label-width":"80px"},{default:o(()=>[s(m,{label:"用户名",prop:"username"},{default:o(()=>[s(_,{modelValue:r.username,"onUpdate:modelValue":e[3]||(e[3]=a=>r.username=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(m,{label:"新密码",prop:"newPassword"},{default:o(()=>[s(_,{modelValue:r.newPassword,"onUpdate:modelValue":e[4]||(e[4]=a=>r.newPassword=a),type:"password",placeholder:"请输入新密码（6位以上）","show-password":""},null,8,["modelValue"])]),_:1}),s(m,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[s(_,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>r.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const pe=Q(ae,[["__scopeId","data-v-02d059c1"]]);export{pe as default};
